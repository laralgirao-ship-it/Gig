  - name: Setup Java JDK
    uses: actions/setup-java@v4
    with:
      distribution: 'temurin'
      java-version: '17'
      cache: gradle

  - name: Configurar Gradle (Cache)
    uses: actions/cache@v4
    with:
      path: |
        ~/.gradle/caches
        ~/.gradle/wrapper
      key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
      restore-keys: ${{ runner.os }}-gradle-

  - name: Aplicar Correções de Propriedades do Gradle
    run: |
      # Define Target SDK
      sed -i 's/^android\.targetSdkVersion=.*/android.targetSdkVersion=36/g' android/gradle.properties || true
      # Garante o uso de AndroidX
      grep -q '^android.useAndroidX=true' android/gradle.properties || echo 'android.useAndroidX=true' >> android/gradle.properties
      # Garante o uso de Jetifier
      grep -q '^android.enableJetifier=true' android/gradle.properties || echo 'android.enableJetifier=true' >> android/gradle.properties

  - name: Build APK (Debug)
    # CORREÇÃO CRÍTICA: Removido working-directory. Usando 'cd android'
    run: |
      cd android
      ./gradlew assembleDebug --no-daemon --stacktrace

  - name: Upload Debug APK
    uses: actions/upload-artifact@v4
    with:
      name: app-debug-apk
      # O path é relativo à raiz do projeto
      path: android/app/build/outputs/apk/debug/app-debug.apk

  - name: Build APK (Release unsigned)
    # CORREÇÃO CRÍTICA: Removido working-directory. Usando 'cd android'
    run: |
      cd android
      ./gradlew assembleRelease --no-daemon --stacktrace

  - name: Upload Release (unsigned)
    uses: actions/upload-artifact@v4
    with:
      name: app-release-unsigned-apk
      path: android/app/build/outputs/apk/release/app-release-unsigned.apk
