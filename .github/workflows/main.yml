  - name: Setup Java JDK
    uses: actions/setup-java@v4
    with:
      distribution: 'temurin'
      java-version: '17'
      cache: gradle

  - name: Configurar Gradle (Cache)
    uses: actions/cache@v4
    with:
      path: |
        ~/.gradle/caches
        ~/.gradle/wrapper
      key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
      restore-keys: ${{ runner.os }}-gradle-

  - name: Aplicar Correções de Propriedades do Gradle
    run: |
      # Define Target SDK (para Android 13/33 ou mais recente, conforme a correção)
      sed -i 's/^android\.targetSdkVersion=.*/android.targetSdkVersion=36/g' android/gradle.properties || true
      # Garante o uso de AndroidX
      grep -q '^android.useAndroidX=true' android/gradle.properties || echo 'android.useAndroidX=true' >> android/gradle.properties
      # Garante o uso de Jetifier (necessário para compatibilidade com bibliotecas antigas)
      grep -q '^android.enableJetifier=true' android/gradle.properties || echo 'android.enableJetifier=true' >> android/gradle.properties

  - name: Build APK (Debug)
    working-directory: android
    # O argumento --stacktrace é útil para depuração
    run: ./gradlew assembleDebug --no-daemon --stacktrace

  - name: Upload Debug APK
    uses: actions/upload-artifact@v4
    with:
      # A chave 'name' foi consolidada para evitar a duplicação na YAML
      name: app-debug-apk
      path: android/app/build/outputs/apk/debug/app-debug.apk

  - name: Build APK (Release unsigned)
    working-directory: android
    run: ./gradlew assembleRelease --no-daemon --stacktrace

  - name: Upload Release (unsigned)
    uses: actions/upload-artifact@v4
    with:
      name: app-release-unsigned-apk
      path: android/app/build/outputs/apk/release/app-release-unsigned.apk
